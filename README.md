# Анализ рынка коммерческой недвижимости

Проект по сбору, обработке и анализу данных о коммерческой недвижимости из различных источников с использованием веб-скрапинга и API.

## Описание проекта

Данный проект реализует полный пайплайн сбора данных о коммерческой недвижимости из различных источников:
- **Веб-скрапинг**: порталы коммерческой недвижимости (Crexi, LoopNet)
- **API**: демографические данные Census Bureau, транспортные данные Google Maps

**Бизнес-задача:** Прогнозирование стоимости аренды и выявление перспективных локаций для ритейлеров.

**Целевая переменная:** `price_per_sqft` (цена за квадратный фут).


## Установка и настройка

### 1. Клонирование репозитория

```bash
git clone https://github.com/kajypij/gp_.git
cd gp_
```

### 2. Установка зависимостей

```bash
python3 -m venv venv
source venv/bin/activate  # Windows: venv\Scripts\activate
pip install -r requirements.txt
```

### 3. Настройка конфигурации

Откройте файл `config.yaml` и заполните API ключи (ключи в файле вымышленные):

```yaml
api_keys:
  census_bureau: "YOUR_CENSUS_API_KEY_HERE"
  google_maps: "YOUR_GOOGLE_MAPS_API_KEY_HERE"
```

**Получение API ключей:**
- **Census Bureau API**: https://api.census.gov/data/key_signup.html
- **Google Maps API**: https://console.cloud.google.com/google/maps-apis

### 4. Настройка логирования

Логирование настраивается через `config.yaml`:

```yaml
logging:
  enabled: true
  level: "INFO"  # DEBUG, INFO, WARNING, ERROR, CRITICAL
  log_file: "logs/project.log"
```

## Использование

### Сбор данных

Полный пайплайн можно запустить через `main.py`

В результате в `data/processed/combined_dataset.csv` сохраняется объединённый набор, готовый к анализу.

### EDA

Откройте ноутбук `notebooks/eda.ipynb`
## Описание данных

### Исходные данные

#### Crexi и LoopNet (веб-скрапинг)

**Описание:** Данные о коммерческой недвижимости, собранные с порталов Crexi и LoopNet.

**Признаки:**
- `source` (str): Источник данных (Crexi/LoopNet)
- `url` (str): URL объекта недвижимости
- `property_id` (str): Уникальный идентификатор объекта
- `title` (str): Название объекта
- `description` (str): **Текстовое описание объекта** (текстовый признак)
- `price` (float): Цена объекта ($)
- `price_per_sqft` (float): Цена за квадратный фут ($/sqft) - **целевая переменная**
- `square_feet` (float): Площадь объекта (кв.фут)
- `property_type` (str): Тип недвижимости
- `city` (str): Город
- `state` (str): Штат (2-буквенный код)
- `address` (str): Адрес объекта
- `year_built` (int): Год постройки
- `parking_spaces` (int): Количество парковочных мест
- `listing_date` (str): Дата публикации объявления

**Количество записей:** 10,000 (5,000 Crexi + 5,000 LoopNet)

#### Census Bureau API

**Описание:** Демографические данные из US Census Bureau.

**Признаки:**
- `population` (int): Население города
- `median_household_income` (float): Медианный доход домохозяйств ($)
- `employment_rate` (float): Уровень занятости (%)
- `total_housing_units` (int): Общее количество жилых единиц
- `vacancy_rate` (float): Уровень вакантности (%)
- `bachelors_degree_rate` (float): Доля населения с высшим образованием (%)
- `state` (str): Штат
- `place` (str): Код места (FIPS)

**Количество запросов:** 5 различных запросов (население, доход, занятость, жилье, образование)

#### Google Maps API

**Описание:** Транспортные данные и доступность локаций. В тестовом запуске указаны 5 эталонных адресов; без нормализации адресов скрапинга и/или геокодирования сопоставление не выполняется, поэтому признаки остаются пустыми.

**Признаки:**
- `address` (str): Адрес объекта
- `latitude` (float): Широта
- `longitude` (float): Долгота
- `nearby_malls_count` (int): Количество торговых центров поблизости (радиус 5 км)
- `nearby_transit_stations_count` (int): Количество остановок транспорта поблизости (радиус 2 км)
- `min_distance_to_key_location_km` (float): Минимальное расстояние до ключевых локаций (км)
- `min_duration_to_key_location_min` (float): Минимальное время до ключевых локаций (минуты)

### Обработанные датасеты

#### `combined_dataset.csv`
- 9 967 записей × 65 признаков.
- Содержит оригинальные данные скрапинга, все сгенерированные признаки (`description_length`, `price_per_sqft_log` и др.), а также агрегаты Census (mean/median по каждому числовому показателю на уровне штата). Поля Google Maps присутствуют, но содержат `NaN`, так как API оплачивает IT-департамент компании.

#### `cleaned_dataset.csv`
- 9 967 записей × 60 признаков.
- В нашем примере все поля Google Maps удалены как полностью пустые (у нас нет доступа к платному API Google Maps); 42 признака `census_*` оставлены и полностью заполнены.
- Пропуски отсутствуют; дубликаты URL удалены.

**Статистика целевой переменной (после очистки):**
- Среднее: $193.56
- Медиана: $99.19
- Минимум: $1.41
- Максимум: $3 905.74
- Стандартное отклонение: $361.46

## Технические детали

### Веб-скрапинг

- **Библиотеки:** `requests`, `beautifulsoup4`, `selenium`
- **Selenium:** Используется для имитации работы пользователя (прокрутка страниц, ожидание загрузки)
- **Обработка:** Регулярные выражения для очистки текста и извлечения данных
- **Задержки:** Настраиваемые задержки между запросами для соблюдения правил сайтов

### API

- **Census Bureau API:** 5+ различных запросов для получения демографических данных
- **Google Maps API:** Геокодирование, поиск ближайших мест, матрица расстояний, маршруты
- **Обработка ошибок:** Логирование всех ошибок API запросов

### Логирование

- **Настройка:** Через `config.yaml`
- **Уровни:** DEBUG, INFO, WARNING, ERROR, CRITICAL
- **Формат:** Время, имя модуля, уровень, сообщение
- **Ротация:** Автоматическая ротация логов (макс. 10 MB, 5 файлов)

## Результаты EDA

### Основные выводы

(Полные графики и таблицы в `notebooks/eda.ipynb`)

1. **Качество данных:**
   - `cleaned_dataset.csv`: 9 967 записей × 60 признаков, пропуски отсутствуют.
   - 1 057 наблюдений (10.6%) считаются выбросами по IQR, это премиальные локации, они сохранены для дальнейшего анализа.

2. **Распределение целевой переменной:**
   - Среднее ≈ $193.6, медиана ≈ $99.2; сильная правосторонняя асимметрия.
   - Логарифмирование `price_per_sqft` снижает skew с 4.78 до ≈0 и делает распределение близким к нормальному.

3. **Связи с целевой переменной:**
   - `price` — corr 0.33 (дорогие лоты → высокая цена за кв. фут).
   - `square_feet` — corr -0.53 (чем больше площадь, тем ниже цена за кв. фут).
   - Демография штата: высокая занятость (corr ≈ 0.78) и низкая вакансия (corr ≈ -0.88) связаны с более высокой стоимостью; доход и доля выпускников дают умеренный положительный эффект.

4. **География:**
   - Медианные цены ($/кв.фут): IL 103, TX 100, NY 99, CA 98, AZ 96.
   - Средние значения в NY и CA превышают $200 за счёт премиальных сегментов.

5. **Типы недвижимости:**
   - Retail 101.9, Mixed Use 99.9, Office 98.6, Warehouse 98.5, Restaurant 98.0 (медианные значения).
   - Violin/boxplot подтверждают многомодальность и высокую дисперсию в премиальных сегментах (Retail, NY).

6. **Временная динамика:**
   - Период: ноябрь 2024 — ноябрь 2025, 500–900 объявлений в месяц.
   - Пики средних цен: декабрь 2024 и ноябрь 2025 (~$221).
   - Просадка: март–июль 2025 (mean 177–180, median около $100), после чего цены восстанавливаются к осени (~$205).

7. **Текстовые данные:**
   - Средняя длина описания 258 символов (35 слов), 55 повторяющихся ключевых слов.
   - Корреляция длины/объёма текста с ценой < 0.02 — вклад миниатюрный; для моделирования потребуются TF-IDF/эмбеддинги.

8. **Бизнес-инсайты:**
   - Наиболее перспективны штаты с высокой занятостью и низкой вакантностью (NY, CA, IL, TX).
  - Retail и Mixed Use демонстрируют максимальные ставки; площадь объекта следует оптимизировать (обратная зависимость).
  - Учитывать сезонность: декабрьские пики и летние просадки важны для планирования аренды.

## Требования проекта

### ✅ Выполнено

- [x] Веб-скрапинг 10,000 записей (5,000 Crexi + 5,000 LoopNet)
- [x] API запросы 5 различных запросов (Census Bureau: население, доход, занятость, жилье, образование)
- [x] Использование Selenium для имитации работы пользователя
- [x] Логирование с настройками через config.yaml
- [x] Объединение данных в единый датасет
- [x] Текстовый признак (описание объекта)
- [x] Целевая переменная (price_per_sqft)
- [x] EDA с анализом пропусков, выбросов, корреляций
- [x] Визуализации и графики
- [x] Очистка данных с использованием регулярных выражений
- [x] README.md с подробным описанием
- [x] .gitignore для исключения ненужных файлов



